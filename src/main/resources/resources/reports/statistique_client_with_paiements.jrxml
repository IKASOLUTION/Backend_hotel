<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports
                                  http://jasperreports.sourceforge.net/xsd/jasperreport.xsd"
              name="statistique_client_with_paiements"
              pageWidth="842" pageHeight="595" orientation="Landscape"
              columnWidth="800" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="80">

    <!-- Styles modernes inspirés du proforma -->
    <style name="ModernText" fontName="DejaVu Sans" fontSize="10"/>
    <style name="ModernTitle" fontName="DejaVu Sans" fontSize="14" isBold="true"/>
    <style name="ModernHeader" fontName="DejaVu Sans" fontSize="12" isBold="true">
        <pen lineColor="#2C3E50"/>
    </style>
    <style name="ModernSubtitle" fontName="DejaVu Sans" fontSize="14" isBold="true">
        <pen lineColor="#34495E"/>
    </style>
    <style name="ModernTableHeader" fontName="DejaVu Sans" fontSize="9" isBold="true">
        <pen lineColor="#FFFFFF"/>
    </style>
    <style name="ModernTableCell" fontName="DejaVu Sans" fontSize="9">
        <pen lineColor="#2C3E50"/>
    </style>
    <style name="AccentText" fontName="DejaVu Sans" fontSize="10" isBold="true">
        <pen lineColor="#3498DB"/>
    </style>

    <!-- ==================== PARAMETERS ==================== -->
    <parameter name="logo" class="java.io.InputStream"/>
    <parameter name="cachet" class="java.io.InputStream"/>
    <parameter name="etab" class="java.lang.String"/>
    <parameter name="adresse" class="java.lang.String"/>
    <parameter name="rccm" class="java.lang.String"/>
    <parameter name="ifu" class="java.lang.String"/>
    <parameter name="banque1" class="java.lang.String"/>
    <parameter name="banque2" class="java.lang.String"/>
    <parameter name="compte1" class="java.lang.String"/>
    <parameter name="compte2" class="java.lang.String"/>
    <parameter name="tel" class="java.lang.String"/>
    <parameter name="tel2" class="java.lang.String"/>
    <parameter name="email" class="java.lang.String"/>
    <parameter name="nomClient" class="java.lang.String"/>
    <parameter name="totalFactures" class="java.math.BigDecimal"/>
    <parameter name="totalPaiements" class="java.math.BigDecimal"/>
    <parameter name="soldeRestant" class="java.math.BigDecimal"/>
    <parameter name="nombreFactures" class="java.lang.Integer"/>
    <parameter name="nombreFacturesSoldees" class="java.lang.Integer"/>
    <parameter name="nombreFacturesEnAttente" class="java.lang.Integer"/>
    <parameter name="SUBREPORT_DIR" class="java.lang.String"/>
    <parameter name="dateImpression" class="java.lang.String" isForPrompting="false">
        <defaultValueExpression><![CDATA[new java.text.SimpleDateFormat("dd/MM/yyyy HH:mm").format(new java.util.Date())]]></defaultValueExpression>
    </parameter>

    <!-- ==================== FIELDS ==================== -->
    <field name="commandeId" class="java.lang.Long"/>
    <field name="numeroCommande" class="java.lang.String"/>
    <field name="dateCommande" class="java.time.LocalDate"/>
    <field name="dateEcheance" class="java.time.LocalDate"/>
    <field name="ref" class="java.lang.String"/>
    <field name="montantTotalTTC" class="java.math.BigDecimal"/>
    <field name="totalPaiements" class="java.math.BigDecimal"/>
    <field name="soldeRestant" class="java.math.BigDecimal"/>
    <field name="isSolde" class="java.lang.Boolean"/>
    <field name="nombrePaiements" class="java.lang.Integer"/>
    <field name="paiements" class="java.util.List"/>

    <!-- ==================== VARIABLES ==================== -->
    <variable name="totalGeneralFactures" class="java.math.BigDecimal" calculation="Sum">
        <variableExpression><![CDATA[$F{montantTotalTTC}]]></variableExpression>
    </variable>

    <variable name="totalGeneralPaiements" class="java.math.BigDecimal" calculation="Sum">
        <variableExpression><![CDATA[$F{totalPaiements}]]></variableExpression>
    </variable>

    <!-- ==================== TITLE (Style Proforma) ==================== -->
    <title>
        <band height="175">
            <!-- Bande supérieure bleue -->
            <rectangle>
                <reportElement x="0" y="0" width="800" height="8" backcolor="#3498DB"/>
            </rectangle>
            
            <!-- Fond gris clair pour l'en-tête -->
            <rectangle>
                <reportElement x="0" y="8" width="800" height="120" backcolor="#ECF0F1"/>
                <graphicElement>
                    <pen lineWidth="0.0"/>
                </graphicElement>
            </rectangle>
            
            <!-- Frame principale -->
            <frame>
                <reportElement x="20" y="20" width="760" height="100"/>
                
                <!-- Cadre pour le logo -->
                <rectangle>
                    <reportElement x="0" y="10" width="80" height="80" backcolor="#FFFFFF"/>
                    <graphicElement>
                        <pen lineWidth="1.0" lineColor="#BDC3C7"/>
                    </graphicElement>
                </rectangle>
                
                <!-- Logo -->
                <image scaleImage="FillFrame">
                    <reportElement x="5" y="15" width="70" height="70"/>
                    <imageExpression><![CDATA[$P{logo}]]></imageExpression>
                </image>
                
                <!-- Nom de l'établissement -->
                <textField isStretchWithOverflow="true">
                    <reportElement style="ModernTitle" x="100" y="10" width="415" height="25" forecolor="#2C3E50"/>
                    <textElement verticalAlignment="Middle">
                        <font size="18" isBold="true"/>
                    </textElement>
                    <textFieldExpression><![CDATA[$P{etab}]]></textFieldExpression>
                </textField>
                
                <!-- Adresse -->
                <textField>
                    <reportElement style="ModernText" x="100" y="35" width="415" height="15"/>
                    <textElement>
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA["Adresse: " + $P{adresse}]]></textFieldExpression>
                </textField>
                
                <!-- Téléphone -->
                <textField>
                    <reportElement style="ModernText" x="100" y="50" width="415" height="15"/>
                    <textElement>
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA["Tel: " + $P{tel}]]></textFieldExpression>
                </textField>
                
                <!-- Email -->
                <textField>
                    <reportElement style="ModernText" x="100" y="65" width="415" height="15"/>
                    <textElement>
                        <font size="9"/>
                    </textElement>
                    <textFieldExpression><![CDATA["Email: " + $P{email}]]></textFieldExpression>
                </textField>
                
                
               
            </frame>
            
            <!-- Titre du rapport avec fond bleu -->
            <rectangle>
                <reportElement x="200" y="140" width="400" height="35" backcolor="#3498DB"/>
                <graphicElement>
                    <pen lineWidth="0.0"/>
                </graphicElement>
            </rectangle>
            <staticText>
                <reportElement x="200" y="140" width="400" height="35" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="16" isBold="true"/>
                </textElement>
                <text><![CDATA[STATISTIQUES  FACTURES & PAIEMENTS]]></text>
            </staticText>
        </band>
    </title>

    <!-- ==================== PAGE HEADER ==================== -->
    <pageHeader>
        <band height="90">
            <!-- Informations client -->
            <rectangle>
                <reportElement x="0" y="10" width="400" height="70" backcolor="#F8F9FA"/>
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#DEE2E6"/>
                </graphicElement>
            </rectangle>
            
            <staticText>
                <reportElement style="ModernSubtitle" x="10" y="15" width="150" height="15" forecolor="#3498DB"/>
                <textElement>
                    <font size="11" isBold="true"/>
                </textElement>
                <text><![CDATA[INFORMATIONS CLIENT]]></text>
            </staticText>
            
            <textField isStretchWithOverflow="true">
                <reportElement style="ModernText" x="10" y="35" width="380" height="12"/>
                <textFieldExpression><![CDATA["Client: " + $P{nomClient}]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement style="ModernText" x="10" y="50" width="190" height="12"/>
                <textFieldExpression><![CDATA["Total Factures: " + new java.text.DecimalFormat("#,##0.00").format($P{totalFactures}) + " FCFA"]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement style="ModernText" x="210" y="50" width="180" height="12"/>
                <textFieldExpression><![CDATA["Total Paiements: " + new java.text.DecimalFormat("#,##0.00").format($P{totalPaiements}) + " FCFA"]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement style="ModernText" x="10" y="65" width="190" height="12"/>
                <textFieldExpression><![CDATA["Solde Restant: " + new java.text.DecimalFormat("#,##0.00").format($P{soldeRestant}) + " FCFA"]]></textFieldExpression>
            </textField>
            
            <!-- Statistiques -->
            <rectangle>
                <reportElement x="420" y="10" width="380" height="70" backcolor="#E8F4FD"/>
                <graphicElement>
                    <pen lineWidth="1.0" lineColor="#3498DB"/>
                </graphicElement>
            </rectangle>
            
            <staticText>
                <reportElement style="AccentText" x="430" y="15" width="165" height="15"/>
                <textElement>
                    <font size="11" isBold="true"/>
                </textElement>
                <text><![CDATA[STATISTIQUES]]></text>
            </staticText>
            
            <textField>
                <reportElement style="ModernText" x="430" y="35" width="165" height="12"/>
                <textFieldExpression><![CDATA["Nombre de factures: " + $P{nombreFactures}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement style="ModernText" x="430" y="50" width="165" height="12"/>
                <textFieldExpression><![CDATA["Factures soldées: " + $P{nombreFacturesSoldees}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement style="ModernText" x="430" y="65" width="165" height="12"/>
                <textFieldExpression><![CDATA["Factures en attente: " + $P{nombreFacturesEnAttente}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement style="ModernText" x="620" y="35" width="165" height="12"/>
                <textFieldExpression><![CDATA["Date d'impression: " + $P{dateImpression}]]></textFieldExpression>
            </textField>
        </band>
    </pageHeader>

    <!-- ==================== COLUMN HEADER ==================== -->
    <columnHeader>
        <band height="30">
            <rectangle>
                <reportElement x="0" y="5" width="800" height="25" backcolor="#2C3E50"/>
            </rectangle>
            
            <staticText>
                <reportElement x="5" y="7" width="90" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Left" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[N° COMMANDE]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="100" y="7" width="70" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[DATE CMD]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="175" y="7" width="70" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[ÉCHÉANCE]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="250" y="7" width="80" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[RÉFÉRENCE]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="335" y="7" width="80" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[MONTANT TTC]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="420" y="7" width="80" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[TOTAL PAYÉ]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="505" y="7" width="80" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[SOLDE RESTANT]]></text>
            </staticText>
            
            <staticText>
                <reportElement x="590" y="7" width="205" height="21" forecolor="#FFFFFF"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="9" isBold="true"/>
                </textElement>
                <text><![CDATA[DÉTAIL DES PAIEMENTS]]></text>
            </staticText>
        </band>
    </columnHeader>

    <!-- ==================== DETAIL ==================== -->
    <detail>
        <band height="60">
            <!-- Ligne de séparation -->
            <line>
                <reportElement x="0" y="0" width="800" height="1" forecolor="#DEE2E6"/>
            </line>
            
            <!-- Données de la facture avec bordures -->
            <textField isBlankWhenNull="true">
                <reportElement x="5" y="5" width="90" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{numeroCommande}]]></textFieldExpression>
            </textField>
            
            <textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
                <reportElement x="100" y="5" width="70" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{dateCommande}]]></textFieldExpression>
            </textField>
            
            <textField pattern="dd/MM/yyyy" isBlankWhenNull="true">
                <reportElement x="175" y="5" width="70" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{dateEcheance}]]></textFieldExpression>
            </textField>
            
            <textField isBlankWhenNull="true">
                <reportElement x="250" y="5" width="80" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{ref}]]></textFieldExpression>
            </textField>
            
            <textField pattern="#,##0.00" isBlankWhenNull="true">
                <reportElement x="335" y="5" width="80" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{montantTotalTTC}]]></textFieldExpression>
            </textField>
            
            <textField pattern="#,##0.00" isBlankWhenNull="true">
                <reportElement x="420" y="5" width="80" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{totalPaiements}]]></textFieldExpression>
            </textField>
            
            <textField pattern="#,##0.00" isBlankWhenNull="true">
                <reportElement x="505" y="5" width="80" height="15"/>
                <box>
                    <pen lineWidth="0.5" lineColor="#BDC3C7"/>
                </box>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8"/>
                </textElement>
                <textFieldExpression><![CDATA[$F{soldeRestant}]]></textFieldExpression>
            </textField>

            <!-- Sous-rapport pour les paiements -->
            <subreport>
                <reportElement x="590" y="5" width="205" height="50"/>
                <dataSourceExpression><![CDATA[new net.sf.jasperreports.engine.data.JRBeanCollectionDataSource($F{paiements})]]></dataSourceExpression>
                <subreportExpression><![CDATA[$P{SUBREPORT_DIR} + "paiements_subreport.jasper"]]></subreportExpression>
            </subreport>
        </band>
    </detail>

    <!-- ==================== PAGE FOOTER (Style Proforma) ==================== -->
    <pageFooter>
        <band height="80">
            <line>
                <reportElement x="0" y="5" width="800" height="1" forecolor="#3498DB"/>
                <graphicElement>
                    <pen lineWidth="2.0"/>
                </graphicElement>
            </line>
            
            <rectangle>
                <reportElement x="0" y="10" width="800" height="45" backcolor="#F8F9FA"/>
                <graphicElement>
                    <pen lineWidth="0.5" lineColor="#DEE2E6"/>
                </graphicElement>
            </rectangle>
            
            <rectangle>
                <reportElement x="10" y="15" width="780" height="20" backcolor="#E8F4FD"/>
                <graphicElement>
                    <pen lineWidth="0.5" lineColor="#3498DB"/>
                </graphicElement>
            </rectangle>
            
            <staticText>
                <reportElement x="15" y="17" width="120" height="8" forecolor="#2C3E50"/>
                <textElement>
                    <font fontName="DejaVu Sans" size="8" isBold="true"/>
                </textElement>
                <text><![CDATA[INFORMATIONS BANCAIRES]]></text>
            </staticText>
            
            <textField isStretchWithOverflow="true">
                <reportElement x="15" y="25" width="380" height="8" forecolor="#34495E"/>
                <textElement>
                    <font fontName="DejaVu Sans" size="7"/>
                </textElement>
                <textFieldExpression><![CDATA["Banque : " + $P{banque1} + " - Compte: " + $P{compte1}]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement x="400" y="25" width="380" height="8" forecolor="#34495E"/>
                <textElement textAlignment="Right">
                    <font fontName="DejaVu Sans" size="7"/>
                </textElement>
                <textFieldExpression><![CDATA["Banque : " + $P{banque2} + " - Compte: " + $P{compte2}]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement x="15" y="38" width="770" height="8" forecolor="#7F8C8D"/>
                <textElement textAlignment="Center">
                    <font fontName="DejaVu Sans" size="7"/>
                </textElement>
                <textFieldExpression><![CDATA["Adresse: "  + $P{tel2} + " | IFU: " + $P{ifu} + " | RCCM: " + $P{rccm}]]></textFieldExpression>
            </textField>
            
            <textField isStretchWithOverflow="true">
                <reportElement x="15" y="47" width="770" height="8" forecolor="#95A5A6"/>
                <textElement textAlignment="Center">
                    <font fontName="DejaVu Sans" size="6" isBold="false" isItalic="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Ouagadougou, Burkina Faso - Entreprise certifiée et agréée"]]></textFieldExpression>
            </textField>
            
            <!-- Pied de page final -->
            <rectangle>
                <reportElement x="0" y="60" width="800" height="18" backcolor="#2C3E50"/>
            </rectangle>
            
            <textField evaluationTime="Report">
                <reportElement x="15" y="63" width="180" height="12" forecolor="#ECF0F1"/>
                <textElement verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="8" isBold="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Page " + $V{PAGE_NUMBER} + "/" + $V{PAGE_COUNT}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="300" y="63" width="200" height="12" forecolor="#BDC3C7"/>
                <textElement textAlignment="Center" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="7"/>
                </textElement>
                <textFieldExpression><![CDATA["Imprimé le " + $P{dateImpression}]]></textFieldExpression>
            </textField>
            
            <textField>
                <reportElement x="520" y="63" width="265" height="12" forecolor="#95A5A6"/>
                <textElement textAlignment="Right" verticalAlignment="Middle">
                    <font fontName="DejaVu Sans" size="7" isItalic="true"/>
                </textElement>
                <textFieldExpression><![CDATA["Système de gestion - À usage exclusivement commercial"]]></textFieldExpression>
            </textField>
            
            <line>
                <reportElement x="0" y="79" width="800" height="1" forecolor="#3498DB"/>
                <graphicElement>
                    <pen lineWidth="1.0"/>
                </graphicElement>
            </line>
        </band>
    </pageFooter>

    <!-- ==================== SUMMARY ==================== -->
    
</jasperReport>